{% if template.name == "product" %}
<div class="wishlist-inspire__icon" x-data="wishlist">
  <button type="button" @click.debounce="addToWishlist">
    <svg class="wishlist-inspire__icon--svg" viewBox="0 0 24 24" stroke-width="2" stroke="#000" :fill="wishlisted ? '#000': '#fff' ">
      <path d="M12 21.35l-1.45-1.32C5.4 15.73 2 12.27 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.77-3.4 7.23-8.55 11.53L12 21.35z"/>
    </svg>
    {% if block.settings.text != blank %}
      <span class="wishlist-inspire__icon--text">{{ block.settings.text }}</span>
    {% endif %}
  </button>
</div>

<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

<script>
  document.addEventListener('alpine:init', () => {
    Alpine.data('wishlist', () => ({
      wishlisted: false,
      appUrl: "https://microphone-gerald-continuously-master.trycloudflare.com/",
      init() {
        fetch(this.appUrl + "api/wishlist?customerId={{ customer.id }}&productId={{ product.id }}&shop={{ shop.permanent_domain }}")
          .then(response => response.json())
          .then(result => {
            if (result.data.length > 0) {
              this.wishlisted = true;
            }
          })
          .catch(error => console.log('error', error));
      },
      addToWishlist() {
        {% unless customer %}
          alert('Please login to add to wishlist');
          return;
        {% endunless %}

        const formdata = new FormData();
        formdata.append("customerId", "{{ customer.id }}");
        formdata.append("productId", "{{ product.id }}");
        formdata.append("shop", "{{ shop.permanent_domain }}");
        formdata.append("_action", this.wishlisted ? "DELETE" : "CREATE");

        fetch(this.appUrl + "api/wishlist", {
          method: 'POST',
          body: formdata,
          redirect: 'follow'
        })
        .then(response => response.json())
        .then(result => {
          this.wishlisted = result.wishlisted;
        })
        .catch(error => console.log('error', error));
      },
    }));
  });
</script> 

<style>
  .wishlist-inspire__icon {
    display: flex;
    justify-content: center;
    max-width: 44rem;
  }
  .wishlist-inspire__icon button {
    background: none;
    border: none;
    padding: 0;
    margin: 0;
    cursor: pointer;
    display: flex;
    gap: 0.5rem;
    align-items: center;
  }
  .wishlist-inspire__icon--svg {
    width: 2rem;
    height: 2rem;
  }
</style>


{%  elsif  template.name == "page" %}
  {% if page.title == "Wishlist" %}
    <style>
      .wishlisted__products__container{
        display:flex;
        gap:2rem;
        flex-wrap:wrap;
        padding:2rem;
      }
      .product__card, .product__price{
        display:flex;
        flex-direction:column;
      }
      .product__card{
        flex:1;
      }
      .product__image__container{
      overflow: hidden;
        height:auto;
        width: auto;
      }
      .product__image{
        height: 100%;
        width: 100%;
        object-fit: cover;
        object-position: center;
      }
      .product__price{
    font-weight:bold;}
      .product__url{
        text-decoration:none;
        color:black;
      }
  </style>
  
  {% if customer %}
    <div id="api-response"></div>
    <script>
      document.addEventListener('DOMContentLoaded', onLoadFunction);
  
      function onLoadFunction() {
          var customerId = "{{ customer.id }}";
          var shop = "{{ shop.permanent_domain }}";
          var apiUrl = 'https://microphone-gerald-continuously-master.trycloudflare.com/api/customerWishlist?customerId=' + customerId + '&shop=' + shop;
  
          fetch(apiUrl)
              .then(response => response.text())
              .then(data => {
                  document.getElementById('api-response').innerHTML = data;
              })
              .catch(error => console.error('Error fetching data:', error));
      }
  
      function deleteItem(productId) {
          var customerId = "{{ customer.id }}";
          var shop = "{{ shop.permanent_domain }}";
  
          fetch('https://microphone-gerald-continuously-master.trycloudflare.com/api/deleteItem?customerId=' + customerId + '&shop=' + shop + '&productId=' + productId)
              .then(response => {
                  if (response.ok) {
                      onLoadFunction();
                  } else {
                      console.error('Error deleting item:', response.statusText);
                  }
              })
              .catch(error => console.error('Error deleting item:', error));
      }
    </script>
  
  {% else %}
    Please Login
  {% endif %}
  {% endif %}
{% endif %}


{% schema %}
  {
    "name": "Wishlist icon",
    "target": "section",
    "settings": [
      {
        "type": "product",
        "id": "product",
        "label": "Product",
        "autofill": true
      },
      {
        "type": "text",
        "id": "text",
        "label": "Text",
        "default": "Add to wishlist"
      },
      {
        "type": "color",
        "id": "colour",
        "label": "Icon Colour",
        "default": "#ff0000"
      }
    ]
  }
  {% endschema %}